<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì‚¬ì„œí•¨ ì‚¬ìš©ëŸ‰ ì›”ê°„ ì ê²€(ë¶™ì—¬ë„£ê¸° ì „ìš©)</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:#f0f2f5; color:#1a202c; padding:20px; line-height:1.6;
    }
    .container { max-width:1600px; margin:0 auto; }
    .card {
      background:#fff; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.12);
      padding:25px; margin-bottom:20px;
    }
    h1 { font-size:24px; margin-bottom:8px; color:#1a202c; font-weight:700; }
    .subtitle { font-size:14px; color:#64748b; margin-bottom:25px; }
    .controls-grid {
      display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:15px; margin-bottom:20px;
    }
    .control-group { display:flex; flex-direction:column; }
    .control-group label { font-size:13px; font-weight:600; color:#475569; margin-bottom:6px; }
    .control-group input[type="number"]{
      padding:10px 14px; border:1px solid #e2e8f0; border-radius:6px; font-size:14px; transition:border-color 0.2s;
    }
    .control-group input:focus { outline:none; border-color:#6366f1; }
    .checkbox-wrapper { display:flex; align-items:center; gap:8px; margin-bottom:20px; }
    .checkbox-wrapper input[type="checkbox"]{ width:18px; height:18px; cursor:pointer; }
    .checkbox-wrapper label { cursor:pointer; font-size:14px; color:#334155; font-weight:500; }
    textarea{
      width:100%; min-height:160px; padding:16px; border:2px dashed #cbd5e0; border-radius:8px;
      font-family:'Courier New', monospace; font-size:13px; resize:vertical; transition:border-color 0.2s;
    }
    textarea:focus{ outline:none; border-color:#6366f1; border-style:solid; }
    .button-row{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      padding:12px 24px; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer;
      transition:all 0.2s; display:inline-flex; align-items:center; gap:6px;
    }
    .btn-primary{ background:#6366f1; color:#fff; flex:1; justify-content:center; font-size:16px; padding:14px 28px; }
    .btn-primary:hover{ background:#4f46e5; transform:translateY(-1px); box-shadow:0 4px 12px rgba(99,102,241,0.4); }
    .btn-secondary{ background:#64748b; color:#fff; }
    .btn-secondary:hover{ background:#475569; }
    .btn-action{ background:#f8fafc; color:#334155; border:1px solid #e2e8f0; }
    .btn-action:hover{ background:#f1f5f9; border-color:#cbd5e0; }
    .summary-section{ margin-bottom:25px; }
    .summary-cards{ display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:16px; }
    .summary-card{
      padding:24px; border-radius:12px; color:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .summary-card.orange{ background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .summary-card.green{ background:linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .summary-card.red{ background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .summary-card.blue{ background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .summary-card h3{ font-size:13px; font-weight:600; margin-bottom:8px; opacity:0.95; }
    .summary-card .value{ font-size:28px; font-weight:700; letter-spacing:-0.5px; }
    .summary-card .subtext{ font-size:12px; margin-top:4px; opacity:0.9; }
    .result-header{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; flex-wrap:wrap; gap:12px;
    }
    .result-title{ font-size:18px; font-weight:700; color:#1a202c; }
    .result-actions{ display:flex; gap:8px; }
    .table-container{ overflow-x:auto; border-radius:8px; border:1px solid #e2e8f0; }
    table{ width:100%; border-collapse:collapse; font-size:13px; }
    th{
      background:#f8fafc; color:#1e293b; padding:14px 12px; text-align:left; font-weight:600;
      border-bottom:2px solid #e2e8f0; cursor:pointer; user-select:none; white-space:nowrap;
    }
    th:hover{ background:#f1f5f9; }
    th.sorted-asc::after{ content:" â–²"; font-size:10px; color:#6366f1; }
    th.sorted-desc::after{ content:" â–¼"; font-size:10px; color:#6366f1; }
    td{ padding:14px 12px; border-bottom:1px solid #f1f5f9; color:#334155; }
    tbody tr:hover{ background:#fafbfc; }
    tr.warning-row{ background:#fee2e2 !important; }
    tr.warning-row:hover{ background:#fecaca !important; }
    td.adjusted-used-cell{ background:#fed7aa; font-weight:600; }
    tr.warning-row td.adjusted-used-cell{ background:#fca5a5; }
    .text-right{ text-align:right; }
    .text-center{ text-align:center; }
    .no-data{ text-align:center; padding:60px 20px; color:#94a3b8; font-size:15px; }
    .error-message{
      background:#fef2f2; color:#dc2626; padding:16px; border-radius:8px; margin-bottom:20px;
      border-left:4px solid #dc2626; font-size:14px;
    }
    .footer-note{
      text-align:center; font-size:13px; color:#64748b; margin-top:20px; padding-top:20px; border-top:1px solid #e2e8f0;
    }
    @media (max-width: 768px){
      .container{ padding:0; }
      .card{ padding:20px; border-radius:0; }
      .controls-grid{ grid-template-columns:1fr; }
      .summary-cards{ grid-template-columns:1fr; }
      .result-header{ flex-direction:column; align-items:flex-start; }
      .result-actions{ width:100%; }
      .result-actions button{ flex:1; }
      table{ font-size:12px; }
      th, td{ padding:10px 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ“Š ì‚¬ì„œí•¨ ì‚¬ìš©ëŸ‰ ì›”ê°„ ì ê²€</h1>
      <p class="subtitle">ì—‘ì…€ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê³  ê³„ì‚°í•˜ì„¸ìš”</p>

      <div class="controls-grid">
        <div class="control-group">
          <label for="allowedCapacity">í—ˆìš©ëŸ‰ (MB)</label>
          <input type="number" id="allowedCapacity" value="6418944" min="0">
        </div>
        <div class="control-group">
          <label for="addMB">ê°€ì‚° MB</label>
          <input type="number" id="addMB" value="200" min="0">
        </div>
      </div>

      <div class="checkbox-wrapper">
        <input type="checkbox" id="capSize" checked>
        <label for="capSize">ì‚¬ì„œí•¨ í¬ê¸° ì´ˆê³¼ ì‹œ ìº¡</label>
      </div>

      <textarea id="pasteArea" placeholder="ì—‘ì…€ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš” (ì˜ˆì‹œ):

ì´ë¦„	ì‚¬ìš©ë¥ (%)	ì‚¬ì„œí•¨ í¬ê¸°(MB)	ì‹¤ ì‚¬ìš©ëŸ‰(MB)	ì‚¬ì„œí•¨
í™ê¸¸ë™	95.0	44700	42373	honghong@kggroup.co.kr
ê¹€ë‘í•œ	92.0	44066	40648	kdh@kggroup.co.kr
ê¹€ì² ìˆ˜	95.0	31091	29528	kcs1234@kggroup.co.kr
ê¹€ë‚˜ë¯¸	95.0	30100	28578	kimnami@kggroup.co.kr"></textarea>

      <div class="button-row">
        <button class="btn-primary" onclick="calculateData()">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
        <button class="btn-secondary" onclick="clearPasteArea()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
      </div>

      <div id="errorMessage"></div>
    </div>

    <div id="summarySection"></div>
    <div id="resultSection"></div>

    <div class="footer-note">
      ğŸ”’ ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì—ì„œë§Œ ì²˜ë¦¬ë˜ë©°, ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </div>
  </div>

  <script>
    // ===== ìƒìˆ˜ =====
    const BASE_MAILBOX_MB = 5120; // ì‚¬ì„œí•¨ í¬ê¸°ê°€ 0ì´ ì•„ë‹Œ ê²½ìš° ìµœì†Œ ë³´ì • ê¸°ì¤€

    // ===== ìƒíƒœ =====
    let rawData = [];
    let processedData = [];
    let currentSort = { column: null, ascending: true };

    // ===== ì»¬ëŸ¼ ë³„ì¹­ =====
    const columnAliases = {
      name: ['ì´ë¦„', 'name'],
      rate: ['ì‚¬ìš©ë¥ ', 'ì‚¬ìš©ë¥ (%)', 'rate', 'usage'],
      size: ['ì‚¬ì„œí•¨í¬ê¸°(mb)', 'ì‚¬ì„œí•¨ í¬ê¸°(mb)', 'í¬ê¸°', 'size'],
      used: ['ì‹¤ì‚¬ìš©ëŸ‰(mb)', 'ì‹¤ ì‚¬ìš©ëŸ‰(mb)', 'ì‚¬ìš©ëŸ‰', 'used'],
      email: ['ì‚¬ì„œí•¨', 'ì´ë©”ì¼', 'email', 'mailbox']
    };

    // ===== ìœ í‹¸ =====
    function normalizeHeader(header){
      return header.toLowerCase().trim().replace(/\s+/g, '');
    }

    function findColumnIndex(headers, aliases){
      const normalized = headers.map(h => normalizeHeader(h));
      for(const alias of aliases){
        const idx = normalized.indexOf(normalizeHeader(alias));
        if(idx !== -1) return idx;
      }
      return -1;
    }

    function parseNumber(value){
      if(value === null || value === undefined || value === '') return 0;
      const str = String(value).replace(/,/g,'').replace(/%/g,'').trim();
      const num = parseFloat(str);
      return isNaN(num) ? 0 : num;
    }

    function formatNumber(num){
      return Math.round(num).toLocaleString('ko-KR');
    }

    function formatMB(num){
      return formatNumber(Math.round(num)) + 'MB';
    }

    function formatMBWithSign(num){
      const absNum = Math.abs(num);
      const formatted = formatNumber(Math.round(absNum)) + 'MB';
      return num < 0 ? '-' + formatted : formatted;
    }

    // ===== íŒŒì„œ =====
    function parseData(text){
      const lines = text.trim().split('\n').filter(line => line.trim());
      if(lines.length < 2){
        throw new Error('ìµœì†Œ 2ì¤„(í—¤ë” + ë°ì´í„° 1ì¤„) ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.');
      }

      const delimiter = lines[0].includes('\t') ? '\t' : /\s{2,}|,/;
      const headers = lines[0].split(delimiter).map(h => h.trim());

      const nameIdx = findColumnIndex(headers, columnAliases.name);
      const rateIdx = findColumnIndex(headers, columnAliases.rate);
      const sizeIdx = findColumnIndex(headers, columnAliases.size);
      const usedIdx = findColumnIndex(headers, columnAliases.used);
      const emailIdx = findColumnIndex(headers, columnAliases.email);

      const missing = [];
      if(nameIdx === -1) missing.push('ì´ë¦„ (ì¸ì‹: ' + columnAliases.name.join(', ') + ')');
      if(sizeIdx === -1) missing.push('ì‚¬ì„œí•¨ í¬ê¸° (ì¸ì‹: ' + columnAliases.size.join(', ') + ')');
      if(usedIdx === -1) missing.push('ì‹¤ ì‚¬ìš©ëŸ‰ (ì¸ì‹: ' + columnAliases.used.join(', ') + ')');
      if(emailIdx === -1) missing.push('ì‚¬ì„œí•¨ (ì¸ì‹: ' + columnAliases.email.join(', ') + ')');

      if(missing.length > 0){
        throw new Error('í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: ' + missing.join(', '));
      }

      const data = [];
      for(let i=1;i<lines.length;i++){
        const cells = lines[i].split(delimiter).map(c => c.trim());
        if(cells.length < Math.max(nameIdx, sizeIdx, usedIdx, emailIdx) + 1) continue;

        const size = parseNumber(cells[sizeIdx]);
        const used = parseNumber(cells[usedIdx]);
        const originalRate = rateIdx !== -1 ? parseNumber(cells[rateIdx]) : 0;

        const row = {
          name: cells[nameIdx] || '',
          originalRate,
          size,
          used,
          email: cells[emailIdx] || ''
        };

        if(row.name || row.email) data.push(row);
      }

      return data;
    }

    // ===== ê³„ì‚° =====
    function calculateAdjustedData(){
      const addMB = parseNumber(document.getElementById('addMB').value);
      const capOnOverflow = document.getElementById('capSize').checked;

      return rawData.map((row, index) => {
        let adjustedUsed;
        let isWarning = false;

        if(row.size === 0){
          // í¬ê¸° ì •ë³´ê°€ ì—†ëŠ” íŠ¹ìˆ˜ ì¼€ì´ìŠ¤: ì› ì‚¬ìš©ëŸ‰ ìœ ì§€ (ê°€ì‚° ì œì™¸)
          adjustedUsed = row.used;
        } else {
          // í¬ê¸° > 0: ê°€ì‚° ì ìš© ì‹œë„
          const tentative = row.used + addMB;

          if(tentative > row.size){
            // ì´ˆê³¼
            isWarning = true;
            adjustedUsed = capOnOverflow ? row.size : row.used; // ìº¡ ì˜µì…˜
          } else {
            adjustedUsed = tentative;
          }

          // âœ… í•µì‹¬ ìš”êµ¬ì‚¬í•­: í¬ê¸° > 0 ì¸ í–‰ì—ì„œ adjustedUsed < 5120ì´ë©´ 5120ìœ¼ë¡œ ë³´ì •
          if(adjustedUsed < BASE_MAILBOX_MB){
            adjustedUsed = BASE_MAILBOX_MB;
          }
        }

        const adjustedRate = row.size > 0 ? (adjustedUsed / row.size * 100) : 0;
        const remainingSpace = row.size > 0 ? Math.max(row.size - adjustedUsed, 0) : 0;

        return {
          ...row,
          rowNumber: index + 1,
          addMB: addMB,
          adjustedUsed: adjustedUsed,
          adjustedRate: Math.round(adjustedRate * 100) / 100,
          remainingSpace: remainingSpace,
          isWarning: isWarning
        };
      });
    }

    // ===== ì •ë ¬/ë Œë” =====
    function sortData(data, column, ascending){
      const sorted = [...data];
      sorted.sort((a,b) => {
        let av = a[column], bv = b[column];
        if(typeof av === 'string'){
          return ascending ? av.localeCompare(bv) : bv.localeCompare(av);
        }
        return ascending ? av - bv : bv - av;
      });
      return sorted;
    }

    function renderSummary(data){
      // í˜„ì¬ ì´ ì‚¬ìš©ëŸ‰(ìš©ëŸ‰ ê´€ì ):
      // - í¬ê¸° 0ì¸ ê²½ìš°: ì‹¤ì‚¬ìš©ëŸ‰
      // - ê·¸ ì™¸: ì‚¬ì„œí•¨ í¬ê¸° ê¸°ì¤€(ìš©ëŸ‰ ì ìœ  ê´€ì )
      let currentTotalUsage = 0;
      data.forEach(row => {
        currentTotalUsage += (row.size === 0 ? row.used : row.size);
      });

      const allowedCapacity = parseNumber(document.getElementById('allowedCapacity').value);
      const currentRemainingCapacity = allowedCapacity - currentTotalUsage;

      // ì´ ê°ì†ŒëŸ‰: ê° ì‚¬ì„œí•¨ì˜ 'ì”ì—¬ ê³µê°„' í•© (size - adjustedUsed)
      const totalReduction = data.reduce((sum, row) => sum + row.remainingSpace, 0);

      // ê°ì†Œ í›„ ì—¬ìœ  ìš©ëŸ‰ = í˜„ì¬ ì—¬ìœ  + ì´ ê°ì†ŒëŸ‰
      const remainingAfterReduction = currentRemainingCapacity + totalReduction;

      const html = `
        <div class="summary-section">
          <div class="summary-cards">
            <div class="summary-card blue">
              <h3>í˜„ì¬ ì´ ì‚¬ìš©ëŸ‰</h3>
              <div class="value">${formatMB(currentTotalUsage)}</div>
              <div class="subtext">í—ˆìš©ëŸ‰: ${formatMB(allowedCapacity)}</div>
            </div>
            <div class="summary-card ${currentRemainingCapacity >= 0 ? 'green':'red'}">
              <h3>í˜„ì¬ ì—¬ìœ  ìš©ëŸ‰</h3>
              <div class="value">${formatMBWithSign(currentRemainingCapacity)}</div>
              <div class="subtext">${currentRemainingCapacity >= 0 ? 'ì—¬ìœ  ìˆìŒ' : 'ì´ˆê³¼ ì‚¬ìš©'}</div>
            </div>
            <div class="summary-card orange">
              <h3>ì´ ê°ì†ŒëŸ‰</h3>
              <div class="value">${formatMB(totalReduction)}</div>
              <div class="subtext">ì”ì—¬ ìš©ëŸ‰ í•©ê³„</div>
            </div>
            <div class="summary-card ${remainingAfterReduction >= 0 ? 'green':'red'}">
              <h3>ê°ì†Œ í›„ ì—¬ìœ ìš©ëŸ‰</h3>
              <div class="value">${formatMBWithSign(remainingAfterReduction)}</div>
              <div class="subtext">${remainingAfterReduction >= 0 ? 'ì—¬ìœ  ìˆìŒ' : 'ì¶”ê°€ ì •ë¦¬ í•„ìš”'}</div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('summarySection').innerHTML = html;
    }

    function renderTable(data){
      if(data.length === 0){
        document.getElementById('resultSection').innerHTML = '';
        return;
      }

      const columns = [
        { key:'rowNumber', label:'ë²ˆí˜¸', align:'center' },
        { key:'name', label:'ì´ë¦„' },
        { key:'email', label:'ì‚¬ì„œí•¨' },
        { key:'size', label:'ì‚¬ì„œí•¨ í¬ê¸°(MB)', align:'right' },
        { key:'used', label:'ì‹¤ ì‚¬ìš©ëŸ‰(MB)', align:'right' },
        { key:'addMB', label:'ê°€ì‚°(+MB)', align:'right' },
        { key:'adjustedUsed', label:'ì¡°ì •_ì‚¬ìš©ëŸ‰(MB)', align:'right', highlight:true },
        { key:'remainingSpace', label:'ì”ì—¬(MB)', align:'right' },
        { key:'adjustedRate', label:'ì¡°ì •_ì‚¬ìš©ë¥ (%)', align:'right' }
      ];

      let theadHtml = '<tr>';
      columns.forEach(col => {
        const sortClass = currentSort.column === col.key
          ? (currentSort.ascending ? 'sorted-asc' : 'sorted-desc')
          : '';
        theadHtml += `<th class="${sortClass}" onclick="handleSort('${col.key}')">${col.label}</th>`;
      });
      theadHtml += '</tr>';

      const fragment = document.createDocumentFragment();
      data.forEach(row => {
        const tr = document.createElement('tr');
        if(row.isWarning) tr.className = 'warning-row';

        columns.forEach(col => {
          const td = document.createElement('td');
          if(col.align) td.className = 'text-' + col.align;
          if(col.highlight) td.classList.add('adjusted-used-cell');

          const k = col.key;
          let value = row[k];

          if(k === 'rowNumber'){
            td.textContent = value;
          } else if(['size','used','addMB','adjustedUsed','remainingSpace'].includes(k)){
            td.textContent = formatNumber(value);
          } else if(k === 'adjustedRate'){
            td.textContent = value.toFixed(1);
          } else {
            td.textContent = value;
          }

          tr.appendChild(td);
        });

        fragment.appendChild(tr);
      });

      const resultHtml = `
        <div class="card">
          <div class="result-header">
            <div class="result-title">ì²˜ë¦¬ ê²°ê³¼ (ì´ ${data.length}ëª…)</div>
            <div class="result-actions">
              <button class="btn-action" onclick="copyToClipboard()">ğŸ“‹ ë³µì‚¬</button>
              <button class="btn-action" onclick="downloadCSV()">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead>${theadHtml}</thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      `;
      document.getElementById('resultSection').innerHTML = resultHtml;
      document.getElementById('tableBody').appendChild(fragment);
    }

    function handleSort(column){
      if(currentSort.column === column) currentSort.ascending = !currentSort.ascending;
      else { currentSort.column = column; currentSort.ascending = true; }

      const sorted = sortData(processedData, column, currentSort.ascending);
      renderTable(sorted);
    }

    // ===== ì•¡ì…˜ =====
    function calculateData(){
      try{
        document.getElementById('errorMessage').innerHTML = '';
        const text = document.getElementById('pasteArea').value;
        if(!text.trim()) throw new Error('ë¶™ì—¬ë„£ê¸° ì˜ì—­ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');

        rawData = parseData(text);
        processedData = calculateAdjustedData();

        renderSummary(processedData);
        renderTable(processedData);
      }catch(err){
        document.getElementById('errorMessage').innerHTML =
          `<div class="error-message"><strong>âš ï¸ ì˜¤ë¥˜:</strong> ${err.message}</div>`;
        document.getElementById('summarySection').innerHTML = '';
        document.getElementById('resultSection').innerHTML = '';
        rawData = []; processedData = [];
      }
    }

    function clearPasteArea(){
      document.getElementById('pasteArea').value = '';
      document.getElementById('errorMessage').innerHTML = '';
      document.getElementById('summarySection').innerHTML = '';
      document.getElementById('resultSection').innerHTML = '';
      rawData = []; processedData = [];
      currentSort = { column:null, ascending:true };
    }

    function downloadCSV(){
      if(processedData.length === 0){ alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

      let dataToExport = processedData;
      if(currentSort.column){
        dataToExport = sortData(processedData, currentSort.column, currentSort.ascending);
      }

      const headers = ['ë²ˆí˜¸','ì´ë¦„','ì‚¬ì„œí•¨','ì‚¬ì„œí•¨ í¬ê¸°(MB)','ì‹¤ ì‚¬ìš©ëŸ‰(MB)','ê°€ì‚°(+MB)','ì¡°ì •_ì‚¬ìš©ëŸ‰(MB)','ì”ì—¬(MB)','ì¡°ì •_ì‚¬ìš©ë¥ (%)'];
      let csv = headers.join(',') + '\n';

      dataToExport.forEach(row => {
        const line = [
          row.rowNumber,
          `"${row.name}"`,
          `"${row.email}"`,
          Math.round(row.size),
          Math.round(row.used),
          row.addMB,
          Math.round(row.adjustedUsed),
          Math.round(row.remainingSpace),
          row.adjustedRate.toFixed(1)
        ].join(',');
        csv += line + '\n';
      });

      const blob = new Blob(['\uFEFF' + csv], { type:'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'ì‚¬ì„œí•¨_ì‚¬ìš©ëŸ‰_ì ê²€_' + new Date().toISOString().split('T')[0] + '.csv';
      link.click();
    }

    function copyToClipboard(){
      if(processedData.length === 0){ alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

      let dataToExport = processedData;
      if(currentSort.column){
        dataToExport = sortData(processedData, currentSort.column, currentSort.ascending);
      }

      const headers = ['ë²ˆí˜¸','ì´ë¦„','ì‚¬ì„œí•¨','ì‚¬ì„œí•¨ í¬ê¸°(MB)','ì‹¤ ì‚¬ìš©ëŸ‰(MB)','ê°€ì‚°(+MB)','ì¡°ì •_ì‚¬ìš©ëŸ‰(MB)','ì”ì—¬(MB)','ì¡°ì •_ì‚¬ìš©ë¥ (%)'];
      let text = headers.join('\t') + '\n';

      dataToExport.forEach(row => {
        const line = [
          row.rowNumber,
          row.name,
          row.email,
          Math.round(row.size),
          Math.round(row.used),
          row.addMB,
          Math.round(row.adjustedUsed),
          Math.round(row.remainingSpace),
          row.adjustedRate.toFixed(1)
        ].join('\t');
        text += line + '\n';
      });

      navigator.clipboard.writeText(text)
        .then(() => alert('âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'))
        .catch(err => alert('âŒ ë³µì‚¬ ì‹¤íŒ¨: ' + err));
    }

    // ì‹¤ì‹œê°„ ë°˜ì˜
    ['addMB','allowedCapacity'].forEach(id => {
      document.getElementById(id).addEventListener('input', () => {
        if(rawData.length > 0){
          processedData = calculateAdjustedData();
          renderSummary(processedData);
          renderTable(processedData);
        }
      });
    });

    document.getElementById('capSize').addEventListener('change', () => {
      if(rawData.length > 0){
        processedData = calculateAdjustedData();
        renderSummary(processedData);
        renderTable(processedData);
      }
    });
  </script>
</body>
</html>
